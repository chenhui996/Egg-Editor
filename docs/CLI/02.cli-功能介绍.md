# cli 功能介绍

- 背景：没接触过 cli 相关的知识。
  - 故笔记稍会繁琐。
  - 目的是为捋清思路。

> 笔记从某一方面来说，是自身学习过程，思路的具像化。

## 目标

- 开发一个名为 @egg-cli 的脚手架。

### 安装方式

```
$ npm i -g @egg-cli/core
```

### 执行命令

```
$ egg-cli
```

## 流程

### 请选择初始化类型：

- **项目**
- **组件**

### 请输入项目名称：

- custom-name

### 请输入项目版本号：

- 1.x.x

### 请选择项目模版：

- 模版类型：
  - **Vue2 标准项目模版**
  - **React 标准项目模版**
  - **Vue3 标准项目模版**
  - **egg 前端标准项目模版（Vue3.0）**

> 对于我们 cli 作者来说 -> 模版是可定制的，并且可以从 **服务端** 动态的进行添加。

- 选择模版后：
  - 下载**选择的模版**。
    - 同时**完成**整个项目的**初始化过程**。
  - 项目依赖安装完成后：
    - 会自动启动项目。

> 创建成功后，**项目源代码**即可在创建目录下找到。

---

## publish 命令

- 发布到线上。

```
$ egg-cli publish
```

### 进入发布流程：

- 获取一些 git 相关信息。
  - 这是因为当 git 仓库不存在时，我们需要对其进行创建。
  - 支持平台（进行托管）：
    - **gitee**
    - **github**
  - 当项目中不存在 .gitignore 时，自动写入。
- 输入 commit 信息。
- 完成代码提交。
- 代码将会直接**推送**到**远程分支**。
- 进行**云构建**：
  - 通过 socket 与我们的**远程的服务器**进行交互：
    - 自动下载安装依赖。
    - 完成项目的构建。
    - 直接完成最后的发布。

> 最终产出：**线上链接** -> 通过线上链接，就可以直接**访问到项目的页面**。

**且此线上链接，还会被发布到 CDN 上。**

---

## 发布到线上

```
$ egg-cli --prod
```

- 发布到线上会删除 dev 分支。
  - dev 分支会作为一个 tag，被放置于 Tags 中。
    - 每次发版。均是如此。

> dev branch -> Tags -> relese/1.x.x

### 再次发布

```
$ egg-cli --prod
```

- 流程：
  - cli 会要求我们**创建一个新的分支**。
    - 这个**分支版本号**必须**大于原有分支**：
      - 小版本（1.0.0 -> 1.0.1）
      - 中版本（1.0.0 -> 1.1.0）
      - 大版本（1.0.0 -> 2.0.0）

---
