# 脚手架开发入门

- 站在前端研发的视角，分析和理解：
  - **开发脚手架的必要性。**
    - 创建项目
    - 发布项目
    - 构建项目
- 从使用角度理解：
  - **什么是脚手架。**
    - 脚手架的本质。
    - 如何**操作**和**使用**一个**脚手架**。
- 分析和掌握脚手架的**实现原理**：
  - 脚手架使用过程中出现障碍（报错等情况）
    - 快速定位到问题所在，并与之解决。
  - 自己直接去开发一个脚手架。
    - 在不了解原理，或者说不熟悉的情况下，直接上手开发：
      - **过程将极为坎坷，全是坑。踩到你崩溃。**
  - 操作系统方面的知识补充：
    - 什么是环境变量？
    - 什么是管理员账号？
    - 什么是 root 账号？
    - 等等...

> 接下来根据上述几点，逐一详解。前路充满困难险阻 -> try again

---

## 站在前端研发的视角，分析开发脚手架的必要性

### 研发效能

- 开发脚手架的核心目标是：
  - **提升前端研发效能**

## 脚手架核心价值

体现 -> 研发过程：

- **自动化**：
  - 项目重复代码拷贝。
  - git 操作。
  - 发布上线操作。
- **标准化**：
  - 项目创建。
  - git flow。
  - 发布流程。
  - 回滚流程。
- **数据化**：
  - 研发过程系统化。
  - 数据化。
  - 使得研发过程可量化。

## 自研脚手架和自动化构建工具的区别

> 问题：jenkins、travis 等自动化构建工具已经比较成熟了，为什么还需要自研脚手架？

- **不满足需求**：
  - jenkins、travis 通常在 git hooks 中触发：
    - 需要在**服务端执行**。
    - 无法覆盖研发人员**本地的功能**，如：
      - 创建项目自动化。
      - 本地 git 操作自动化。
      - 等等
- **定制复杂**：
  - jenkins、travis 定制过程需要开发插件：
    - 其过过程较为复杂：
      - 如需要使用 java 语言。
        - 这对前端人员来说，其实不够友好。

---

### 小总结

对于一些有一定规模的前端团队来说：
开发**自研 cli**，是非常必要的。

- 理由：
  - 团队运维期间（中后期）：
    - 在项目过程中，会沉淀大量的组件。
    - 组件的沉淀，也需要**工具的支持**。
      - 这其实也可是 cli 的一部分。

---

## 从使用角度理解什么是脚手架？

- 这个问题非常重要：
  - 因为这是我们学习和理解**cli 原理**的一个基础。

> 需彻底了解了 cli 是什么，才能理解 cli 的原理。

### 脚手架简介

- 本质：
  - 脚手架本质是一个**操作系统的客户端**。
  - 通过命令行执行，如:

```
$ vue create vue-test-app
```

上述命令由 3 个部分组成：

- 主命令：vue
- command： cretae
- command 的 param：vue-test-app

代表：

- 创建一个项目
- 项目的名称为 vue-test-app

---

### 脚手架处理流程

例句：

```
$ vue create vue-test-app
```

> 思考：当在命令行输入上述命令后，终端是如何处理的？（比较困难）

在命令行输入明后，终端的执行流程：

#### which

首先，会在**环境变量**中寻找 -> 名称为 vue 的指令 -> 方法：

```
$ which vue
```

输入后，反馈：

```
/usr/local/bin/vue
```

得出结论：

- 执行 vue 命令。实则是执行/usr/local/bin/vue 命令。

#### 软链接

```
$ /usr/local/bin
```

进入 /usr/local/bin 目录后，用 ll 命令可看到：

```
lrwxr-xr-x  1 chenhui  admin    39B  7  5 00:38 vue -> ../lib/node_modules/@vue/cli/bin/vue.js
```

得出结论：

- vue 指令只是一个软链接，实则执行的是 node 下的 ../lib/node_modules/@vue/cli/bin/vue.js

---

#### vue.js

```
$ /usr/local/lib/node_modules
```

> 此目录即为我们用 npm i -g 命令安装的全局的包。

进入目录后，用 ll 命令可看到：

```
drwxr-xr-x   3 chenhui  admin    96B  7  5 00:38 @vue
```

- @vue 即我们通过 `npm i -g @vue/cli` 命令全局安装的 vue 包。
  - 可进入 @vue 目录下查看：
    - @vue -> cli -> bin -> **vue.js**

得出结论：

- 综上所述，在终端执行 vue 命令。实则是通过上述流程进行执行的。

---

### 总结精炼流程

- 脚手架的执行原理如下：
  - 在终端输入 vue create vue-test-app
  - 终端解析出 vue 命令
  - 终端在环境变量中找到 vue 命令
  - 终端根据 vue 命令链接到实际文件 vue.js
  - 终端利用 node 执行 vue.js
  - vue.js 解析 command/options
  - vue.js 执行 command
  - 执行完毕，退出执行

---

## 从应用的角度看如何开发一个脚手架

> 这里以 vue-cli 为例

- 开发 npm 项目，该项目中应包含一个 bin/vue.js 文件,并将这个项目发布到 npm。
- 发布完成后，即可将 npm 项目安装到 node 的 lib/node_modules。（全局安装）
- 在 node 的 bin 目录下配置 vue 软链接，指向 lib/node_modules/@vue/cli/bin/vue.js

> 这样，我们在执行 vue 命令时，就可以顺利找到 vue.js 进行执行。

---

## cli 的实现原理

- 笔记链接：
  - https://github.com/chenhui996/egg-cli/blob/main/docs/CLI-Implementation-Pprinciple.md

---

### cli 原理进阶

掌握 cli 基本实现原理后，可以尝试回答以下问题：

- 为什么说脚手架本质是操作系统的客户端？它和我们在 PC 上安装的应用/软件有什么区别？
- 如何为 node 脚手架命令创建别名？
- 描述脚手命令执行的全过程。

#### 为什么说脚手架本质是操作系统的客户端？它和我们在 PC 上安装的应用/软件有什么区别？

- 回答 1:
  - 本质上是：
    - node 是一个可执行文件。
    - 不是脚手架是操作系统的客户端，是 node 本质是一个客户端（可执行文件）。
      - js 在终端执行，需要通过 node 这个解释器进行执行。
- 回答 2:
  - 本质上是：
    - 没有区别。
      - windows： .exe 后缀。
      - mac：可执行文件。
  - 硬要说区别：
    - 安装完成后，提供各自的 GUI。（node 没有 GUI）
    - 追问：node 可以绘制 GUI 吗？
      - 答：可以 -> 调用操作系统的绘制 GUI 的 API，就可以绘制窗口。

#### 如何为 node 脚手架命令创建别名？

- 1. 编写软链接 -> 链接名称即为脚手架命令别名。
- 2. 再创建软链接 -> 指向之前创建的软链接。（也就是再套一层 -> 嵌套）

#### 描述脚手架执行的全过程

- 链接：https://github.com/chenhui996/egg-cli/blob/main/docs/CLI-Implementation-Pprinciple.md#%E6%89%A7%E8%A1%8C-vue-%E5%91%BD%E4%BB%A4%E6%97%B6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88
